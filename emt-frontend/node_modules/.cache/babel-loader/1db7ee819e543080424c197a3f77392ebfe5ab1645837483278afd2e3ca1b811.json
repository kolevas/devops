{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from \"react\";\nimport userRepository from \"../repository/userRepository\";\nimport { useNavigate } from \"react-router-dom\";\nconst useUsers = () => {\n  _s();\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const [loginState, setLoginState] = useState(false);\n  const navigate = useNavigate();\n  // useEffect(() => {\n  //     const token = localStorage.getItem(\"jwtToken\");\n  //     if (token) {\n  //         const user = JSON.parse(atob(token.split(\".\")[1]));\n  //         setLoggedInUser(user);\n  //         setLoginState(true)\n  //\n  //     }\n  //     else setLoginState(false)\n  // }, []);\n  const checkAuth = () => {\n    const token = localStorage.getItem(\"jwtToken\");\n    if (token) {\n      const user = JSON.parse(atob(token.split(\".\")[1]));\n      setLoggedInUser(user);\n      setLoginState(true);\n    } else {\n      setLoggedInUser(null);\n      setLoginState(false);\n    }\n  };\n  useEffect(() => {\n    checkAuth();\n    const handleStorageChange = () => {\n      checkAuth();\n    };\n    window.addEventListener(\"storage\", handleStorageChange);\n    return () => {\n      window.removeEventListener(\"storage\", handleStorageChange);\n    };\n  }, []);\n  const login = useCallback((username, password) => {\n    userRepository.login(username, password).then(() => {\n      const token = localStorage.getItem(\"jwtToken\");\n      if (token) {\n        checkAuth();\n        navigate(\"/\", {\n          replace: true\n        });\n      }\n    }).catch(error => console.log(error));\n  }, [navigate]);\n\n  // const login = async (username, password) => {\n  //     await userRepository.login(username, password);\n  //     const token = localStorage.getItem(\"jwtToken\");\n  //     if (token) {\n  //         const user = JSON.parse(atob(token.split(\".\")[1]));\n  //         setLoggedInUser(user);\n  //     }\n  // };\n\n  const logout = () => {\n    userRepository.logout();\n    setLoggedInUser(null);\n    setLoginState(false);\n  };\n\n  // const isAuthenticated = () => !!localStorage.getItem(\"jwtToken\");\n\n  return {\n    loggedInUser,\n    login,\n    logout,\n    setLoginState,\n    loginState\n    // isAuthenticated,\n  };\n};\n_s(useUsers, \"dSzj40Tp6BtcVVK6wxjamgDhajk=\", false, function () {\n  return [useNavigate];\n});\nexport default useUsers;","map":{"version":3,"names":["useCallback","useEffect","useState","userRepository","useNavigate","useUsers","_s","loggedInUser","setLoggedInUser","loginState","setLoginState","navigate","checkAuth","token","localStorage","getItem","user","JSON","parse","atob","split","handleStorageChange","window","addEventListener","removeEventListener","login","username","password","then","replace","catch","error","console","log","logout"],"sources":["/Users/snezhanakoleva/IdeaProjects/EMT/emt-frontend/src/hooks/useUsers.js"],"sourcesContent":["import {useCallback, useEffect, useState} from \"react\";\nimport userRepository from \"../repository/userRepository\";\nimport {useNavigate} from \"react-router-dom\";\n\nconst useUsers = () => {\n    const [loggedInUser, setLoggedInUser] = useState(null);\n    const [loginState, setLoginState] = useState(false)\n    const navigate = useNavigate()\n    // useEffect(() => {\n    //     const token = localStorage.getItem(\"jwtToken\");\n    //     if (token) {\n    //         const user = JSON.parse(atob(token.split(\".\")[1]));\n    //         setLoggedInUser(user);\n    //         setLoginState(true)\n    //\n    //     }\n    //     else setLoginState(false)\n    // }, []);\n    const checkAuth = () => {\n        const token = localStorage.getItem(\"jwtToken\");\n        if (token) {\n            const user = JSON.parse(atob(token.split(\".\")[1]));\n            setLoggedInUser(user);\n            setLoginState(true);\n        } else {\n            setLoggedInUser(null);\n            setLoginState(false);\n        }\n    };\n\n    useEffect(() => {\n        checkAuth();\n\n        const handleStorageChange = () => {\n            checkAuth();\n        };\n\n        window.addEventListener(\"storage\", handleStorageChange);\n\n        return () => {\n            window.removeEventListener(\"storage\", handleStorageChange);\n        };\n    }, []);\n\n    const login = useCallback((username, password)=>{\n        userRepository\n            .login(username, password)\n            .then(()=> {\n                const token = localStorage.getItem(\"jwtToken\");\n                if (token) {\n                    checkAuth();\n                    navigate(\"/\", { replace: true });\n                }\n            })\n            .catch((error) => console.log(error));\n    }, [navigate])\n\n    // const login = async (username, password) => {\n    //     await userRepository.login(username, password);\n    //     const token = localStorage.getItem(\"jwtToken\");\n    //     if (token) {\n    //         const user = JSON.parse(atob(token.split(\".\")[1]));\n    //         setLoggedInUser(user);\n    //     }\n    // };\n\n    const logout = () => {\n        userRepository.logout();\n        setLoggedInUser(null);\n        setLoginState(false)\n    };\n\n    // const isAuthenticated = () => !!localStorage.getItem(\"jwtToken\");\n\n\n    return {\n        loggedInUser,\n        login,\n        logout,\n        setLoginState, loginState\n        // isAuthenticated,\n    };\n};\n\nexport default useUsers;\n"],"mappings":";AAAA,SAAQA,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAO,OAAO;AACtD,OAAOC,cAAc,MAAM,8BAA8B;AACzD,SAAQC,WAAW,QAAO,kBAAkB;AAE5C,MAAMC,QAAQ,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGN,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAM,CAACO,UAAU,EAAEC,aAAa,CAAC,GAAGR,QAAQ,CAAC,KAAK,CAAC;EACnD,MAAMS,QAAQ,GAAGP,WAAW,CAAC,CAAC;EAC9B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMQ,SAAS,GAAGA,CAAA,KAAM;IACpB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;IAC9C,IAAIF,KAAK,EAAE;MACP,MAAMG,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;MAClDZ,eAAe,CAACQ,IAAI,CAAC;MACrBN,aAAa,CAAC,IAAI,CAAC;IACvB,CAAC,MAAM;MACHF,eAAe,CAAC,IAAI,CAAC;MACrBE,aAAa,CAAC,KAAK,CAAC;IACxB;EACJ,CAAC;EAEDT,SAAS,CAAC,MAAM;IACZW,SAAS,CAAC,CAAC;IAEX,MAAMS,mBAAmB,GAAGA,CAAA,KAAM;MAC9BT,SAAS,CAAC,CAAC;IACf,CAAC;IAEDU,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEF,mBAAmB,CAAC;IAEvD,OAAO,MAAM;MACTC,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAEH,mBAAmB,CAAC;IAC9D,CAAC;EACL,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMI,KAAK,GAAGzB,WAAW,CAAC,CAAC0B,QAAQ,EAAEC,QAAQ,KAAG;IAC5CxB,cAAc,CACTsB,KAAK,CAACC,QAAQ,EAAEC,QAAQ,CAAC,CACzBC,IAAI,CAAC,MAAK;MACP,MAAMf,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;MAC9C,IAAIF,KAAK,EAAE;QACPD,SAAS,CAAC,CAAC;QACXD,QAAQ,CAAC,GAAG,EAAE;UAAEkB,OAAO,EAAE;QAAK,CAAC,CAAC;MACpC;IACJ,CAAC,CAAC,CACDC,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC,CAAC;EAC7C,CAAC,EAAE,CAACpB,QAAQ,CAAC,CAAC;;EAEd;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA,MAAMuB,MAAM,GAAGA,CAAA,KAAM;IACjB/B,cAAc,CAAC+B,MAAM,CAAC,CAAC;IACvB1B,eAAe,CAAC,IAAI,CAAC;IACrBE,aAAa,CAAC,KAAK,CAAC;EACxB,CAAC;;EAED;;EAGA,OAAO;IACHH,YAAY;IACZkB,KAAK;IACLS,MAAM;IACNxB,aAAa;IAAED;IACf;EACJ,CAAC;AACL,CAAC;AAACH,EAAA,CA9EID,QAAQ;EAAA,QAGOD,WAAW;AAAA;AA6EhC,eAAeC,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}