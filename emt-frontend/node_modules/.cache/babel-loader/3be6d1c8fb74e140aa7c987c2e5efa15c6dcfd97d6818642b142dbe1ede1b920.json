{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from \"react\";\nimport userRepository from \"../repository/userRepository\";\nimport { useNavigate } from \"react-router-dom\";\nconst useUsers = () => {\n  _s();\n  const [loggedInUser, setLoggedInUser] = useState(null);\n  const navigate = useNavigate();\n  const checkAuth = () => {\n    const token = localStorage.getItem(\"jwtToken\");\n    const user = token ? JSON.parse(atob(token.split(\".\")[1])) : null;\n    setLoggedInUser(user);\n  };\n  useEffect(() => {\n    checkAuth();\n    const handleStorageChange = ({\n      key\n    }) => {\n      if (key === \"jwtToken\") checkAuth();\n    };\n    window.addEventListener(\"storage\", handleStorageChange);\n    return () => window.removeEventListener(\"storage\", handleStorageChange);\n  }, []);\n  const login = useCallback((username, password) => {\n    userRepository.login(username, password).then(() => {\n      checkAuth();\n      navigate(\"/\", {\n        replace: true\n      });\n    }).catch(console.error);\n  }, [navigate]);\n  const logout = () => {\n    localStorage.removeItem(\"jwtToken\");\n    checkAuth();\n    navigate(\"/user/login\", {\n      replace: true\n    });\n  };\n  return {\n    loggedInUser,\n    login,\n    logout\n  };\n};\n_s(useUsers, \"ipevZF2JXvE9rRAdtzs35kJcvnA=\", false, function () {\n  return [useNavigate];\n});\nexport default useUsers;","map":{"version":3,"names":["useCallback","useEffect","useState","userRepository","useNavigate","useUsers","_s","loggedInUser","setLoggedInUser","navigate","checkAuth","token","localStorage","getItem","user","JSON","parse","atob","split","handleStorageChange","key","window","addEventListener","removeEventListener","login","username","password","then","replace","catch","console","error","logout","removeItem"],"sources":["/Users/snezhanakoleva/IdeaProjects/EMT/emt-frontend/src/hooks/useUsers.js"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport userRepository from \"../repository/userRepository\";\nimport { useNavigate } from \"react-router-dom\";\n\nconst useUsers = () => {\n    const [loggedInUser, setLoggedInUser] = useState(null);\n    const navigate = useNavigate();\n\n    const checkAuth = () => {\n        const token = localStorage.getItem(\"jwtToken\");\n        const user = token ? JSON.parse(atob(token.split(\".\")[1])) : null;\n        setLoggedInUser(user);\n    };\n\n    useEffect(() => {\n        checkAuth();\n\n        const handleStorageChange = ({ key }) => {\n            if (key === \"jwtToken\") checkAuth();\n        };\n\n        window.addEventListener(\"storage\", handleStorageChange);\n        return () => window.removeEventListener(\"storage\", handleStorageChange);\n    }, []);\n\n    const login = useCallback((username, password) => {\n        userRepository.login(username, password).then(() => {\n            checkAuth();\n            navigate(\"/\", { replace: true });\n        }).catch(console.error);\n    }, [navigate]);\n\n    const logout = () => {\n        localStorage.removeItem(\"jwtToken\");\n        checkAuth();\n        navigate(\"/user/login\", { replace: true });\n    };\n\n    return { loggedInUser, login, logout };\n};\n\nexport default useUsers;\n"],"mappings":";AAAA,SAASA,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACxD,OAAOC,cAAc,MAAM,8BAA8B;AACzD,SAASC,WAAW,QAAQ,kBAAkB;AAE9C,MAAMC,QAAQ,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACnB,MAAM,CAACC,YAAY,EAAEC,eAAe,CAAC,GAAGN,QAAQ,CAAC,IAAI,CAAC;EACtD,MAAMO,QAAQ,GAAGL,WAAW,CAAC,CAAC;EAE9B,MAAMM,SAAS,GAAGA,CAAA,KAAM;IACpB,MAAMC,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC;IAC9C,MAAMC,IAAI,GAAGH,KAAK,GAAGI,IAAI,CAACC,KAAK,CAACC,IAAI,CAACN,KAAK,CAACO,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI;IACjEV,eAAe,CAACM,IAAI,CAAC;EACzB,CAAC;EAEDb,SAAS,CAAC,MAAM;IACZS,SAAS,CAAC,CAAC;IAEX,MAAMS,mBAAmB,GAAGA,CAAC;MAAEC;IAAI,CAAC,KAAK;MACrC,IAAIA,GAAG,KAAK,UAAU,EAAEV,SAAS,CAAC,CAAC;IACvC,CAAC;IAEDW,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEH,mBAAmB,CAAC;IACvD,OAAO,MAAME,MAAM,CAACE,mBAAmB,CAAC,SAAS,EAAEJ,mBAAmB,CAAC;EAC3E,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMK,KAAK,GAAGxB,WAAW,CAAC,CAACyB,QAAQ,EAAEC,QAAQ,KAAK;IAC9CvB,cAAc,CAACqB,KAAK,CAACC,QAAQ,EAAEC,QAAQ,CAAC,CAACC,IAAI,CAAC,MAAM;MAChDjB,SAAS,CAAC,CAAC;MACXD,QAAQ,CAAC,GAAG,EAAE;QAAEmB,OAAO,EAAE;MAAK,CAAC,CAAC;IACpC,CAAC,CAAC,CAACC,KAAK,CAACC,OAAO,CAACC,KAAK,CAAC;EAC3B,CAAC,EAAE,CAACtB,QAAQ,CAAC,CAAC;EAEd,MAAMuB,MAAM,GAAGA,CAAA,KAAM;IACjBpB,YAAY,CAACqB,UAAU,CAAC,UAAU,CAAC;IACnCvB,SAAS,CAAC,CAAC;IACXD,QAAQ,CAAC,aAAa,EAAE;MAAEmB,OAAO,EAAE;IAAK,CAAC,CAAC;EAC9C,CAAC;EAED,OAAO;IAAErB,YAAY;IAAEiB,KAAK;IAAEQ;EAAO,CAAC;AAC1C,CAAC;AAAC1B,EAAA,CAnCID,QAAQ;EAAA,QAEOD,WAAW;AAAA;AAmChC,eAAeC,QAAQ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}